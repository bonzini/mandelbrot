project('mandelbrot', 'rust',
  version : '0.1.0',
  meson_version : '>= 1.0.0',
  default_options : ['buildtype=debugoptimized',
                     'rust_std=2018',
                    ]
)

add_global_arguments(
  '-C', 'embed-bitcode=no',
  language: 'rust'
)

# trigger dependency resolution and apply dependency features in Cargo.toml.
cargo = import('rust').workspace()
pkg = cargo.package()
# cargo.package().executable('mandelbrot', install: true)

executable('mandelbrot', 'src/main.rs',
  rust_dependency_map : pkg.rust_dependency_map(),
  rust_args: pkg.rust_args(),
  dependencies : pkg.dependencies(),
  install : true,
)
